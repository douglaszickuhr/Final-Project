---
title: "Clustering companies by consumer complaints"
author: "Douglas Zickuhr"
date: "21/06/2018"
output: html_document
---

# First step is to load the libraries
```{r libraries}
library(tidyverse)
library(forcats)
library(knitr)
library(factoextra)
library(ggbiplot)
```

## Loading the dataset
```{r read sumarised dataset}
clustered_companies <- read_csv('data/clustered_companies.csv')
```

```{r pca biplot}
biplot <- fviz_pca_biplot(X = companies_pca,
                label = "var",
                col.var = "red",
                title = "Consumer Complaints - PC1 and PC2",
                addEllipses  = TRUE,
                ggtheme = theme_bw(),
                alpha = 0.3)

biplot
ggsave(filename = "img/biplot.png",
       plot = biplot)

```


```{r elbow}
return_wss <- function(k, df) {
  x <- kmeans(x = df, centers = k, nstart = 20)
  x$tot.withinss
}

elbow <- tibble(cluster = 2:10, tot.withinss = map_dbl(2:10,return_wss,df = clustered_companies %>%
                                                select(starts_with("PC")))) %>%
  ggplot(aes(x=cluster,y=tot.withinss)) + 
  geom_line() + 
  geom_point() + 
  geom_point(data=tibble(x=4,y=1456.7857), 
             aes(x=x, y=y), colour="red", size=10, alpha = 0.5) +
  labs(title = "Elbow plot",
       x = "Number of clusters k",
       y = "Total within-clusters sum of squares") + 
  theme_bw()

ggsave("img/elbow.png",
       plot = elbow)

elbow
```



```{r}
fviz_cluster(companies_kmeans,
             companies_with_pca %>%
                  select(PC1,PC2),
             geom = "point", 
             shape = 16,
             ggtheme = theme_minimal(),
             alpha = 0.5)
```

```{r}
kmeans_dist <- dist(scale(clustered_companies %>% select(starts_with("PC"))))
sil <- silhouette(clustered_companies$kmeans_cluster,kmeans_dist)

silplot <- fviz_silhouette(sil, label = FALSE, print.summary = TRUE)
ggsave(filename = "img/silhouette.png",
       plot = silplot)

silplot
```

